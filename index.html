<html>
  <head>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }
      .container {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #f5f5f5;
        filter: blur(20px) contrast(100);
      }
      .goo {
        position: absolute;
        width: 100px;
        height: 100px;
        background-color: black;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        cursor: grab;
        touch-action: none; /* Prevent default scrolling while dragging */
      }

      /* when dark reader is enabled */
      html[data-darkreader-scheme="dark"] .goo {
        background-color: white !important;
      }

      .overlay {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .overlay button {
        background-color: #007bff;
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .overlay button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="overlay">
      <button id="addGoo">Add Goo</button>
    </div>
    <div class="container" id="container">
      <div class="goo"></div>
    </div>

    <script>
      const container = document.getElementById("container");
      const existingGoo = new WeakSet();

      let currentGoo = null;
      let offsetX = 0;
      let offsetY = 0;

      function getCoords(e) {
        if (e.touches && e.touches.length > 0) {
          return { x: e.touches[0].clientX, y: e.touches[0].clientY };
        }
        return { x: e.clientX, y: e.clientY };
      }

      function onMove(e) {
        if (!currentGoo) return;
        e.preventDefault();
        const { x, y } = getCoords(e);
        currentGoo.style.left = `${x - offsetX}px`;
        currentGoo.style.top = `${y - offsetY}px`;
      }

      function onEnd() {
        if (!currentGoo) return;
        document.removeEventListener("mousemove", onMove);
        document.removeEventListener("mouseup", onEnd);
        document.removeEventListener("touchmove", onMove);
        document.removeEventListener("touchend", onEnd);
        currentGoo.style.cursor = "grab";
        currentGoo = null;
      }

      function enableDrag(goo) {
        if (existingGoo.has(goo)) return;
        existingGoo.add(goo);

        goo.addEventListener("mousedown", (e) => {
          currentGoo = goo;
          const rect = goo.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
          goo.style.cursor = "grabbing";

          document.addEventListener("mousemove", onMove, { passive: false });
          document.addEventListener("mouseup", onEnd);
        });

        goo.addEventListener("touchstart", (e) => {
          const touch = e.touches[0];
          const rect = goo.getBoundingClientRect();
          offsetX = touch.clientX - rect.left;
          offsetY = touch.clientY - rect.top;
          currentGoo = goo;
          goo.style.cursor = "grabbing";

          document.addEventListener("touchmove", onMove, { passive: false });
          document.addEventListener("touchend", onEnd);
        });
      }

      const randomPercent = (min, max) =>
        Math.random() * (max - min) + min + "%";

      document.querySelectorAll(".goo").forEach(enableDrag);
      document.getElementById("addGoo").addEventListener("click", () => {
        const newGoo = document.createElement("div");
        newGoo.className = "goo";
        newGoo.style.left = randomPercent(30, 80);
        newGoo.style.top = randomPercent(30, 80);
        enableDrag(newGoo);
        container.appendChild(newGoo);
      });
    </script>
  </body>
</html>
